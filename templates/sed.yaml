# this refers to the entire sed unit (including tank and channels)

{# macros are Jinja functions. The "render" function here renders the sed yaml. #}
{% macro render() %}{% include "sed.yaml"%}{% endmacro %}

{% set bottom_angle = con.ANGLE_SED_SLOPE %}
{% set sed_slab_thickness = opt.THICKNESS_PLANT_FLOOR %}
{% set sed_divider_wall = opt.THICKNESS_SED_WALL %}
{% set channel_wall_thickness = opt.THICKNESS_SED_WALL %}
{% set floc_blanket_height = opt.FLOC_BLANKET_HEIGHT %}
{% set dist_top_settler_bottom_launder =  %}  # value needs to be confirmed in Mathcad
{% set headloss_outlet_man = opt.HL_OUTLET_MAN %}
{% set angle_sed_plate = con.ANGLE_SED_PLATE}
{% set space_sed_plate = con.SPACE_SED_PLATE}
{% set SDR_spacer = con.SDR_SED_MOD_SPACER}

{% set W_diff_inner = sed.w_diffuser_inner(W_tank)}
{% set W_diff_outer = sed.w_diffuser_outer(W_tank)}
{% set L_diff_outer = sed.L_diffuser_outer(W_tank)}
{% set L_diff_inner = sed.L_diffuser_inner(W_tank)}
- sed :
  - L :
  - W :
  - inlet_channel:
    - hp:
    - dp:
      - W_inlet :
      - L_inlet :
      - H_weir :
  - exit_channel:
    - hp:
    - dp:
      - W_inlet :
      - L_inlet :
      - H_weir :
  - tank:
    - hp:
      - floc_blanket_height : {{ floc_blanket_height }}
      - L_tank :
    - dp:
      - L_tank : {{ L_tank }}
      - W_tank : {{ width_sed_tank }} # comes from materials.yaml
      - bottom_angle : {{ bottom_angle }}
      - sed_slab_thickness : {{ sed_slab_thickness }}
      - sed_divider_wall : {{ sed_divider_wall }}
      - channel_wall_thickness : {{ channel_wall_thickness }}
      - dist_top_settler_bottom_launder : {{ dist_top_settler_bottom_launder }}
  - inlet_manifold:
    - hp:
      - max_flow : {{ max_flow }}
      - max_vel : {{ max_vel }}
    - dp:
      - OD_pipe : {{ OD_pipe }}
  - diffusers:
    - hp:
    - dp:
      - W_diff_inner : {{ W_diff_inner }}
      - W_diff_outer : {{ W_diff_outer }}
      - L_diff_inner : {{ L_diff_inner }}
      - L_diff_outer : {{ L_diff_outer }}
  - outlet_manifold:
    - hp:
      - headloss : {{ headloss_outlet_man }}
    - dp:
      - OD_pipe : {{ OD_pipe }}
      - diam_orifice_outlet_man : {{ diam_orifice_outlet_man }}
  - plate_settlers:
    - hp:
    - dp:
      - length : {{ length }}
      - OD_frame : {{ OD_frame }}
      - area_top_floc_blanket : {{ area_top_floc_blanket }}
      - angle_sed_plate : {{ angle_sed_plate}}
      - space_sed_plate : {{ space_sed_plate }}
      - thickness_sed_plate : {{ thickness_sed_plate}}
  - plate_settler_module:
    - hp:
    - dp:
      - SDR_spacer : {{ SDR_spacer }}
      - plate_number : {{ plate_number }}
  - floc_hopper:

- constants:
  - tank:
    - vel_up : 1 millimeter/second
    - angle_bottom_tank : 50 degree
    - depth_water_est : 2 meter
    - L_est : 60 centimeter
  - plate_settlers:
    - vel_capture : 0.12 millimeter/second
    - angle_plate : 60 degree
    - S_plate : 2.5 centimeter
    - plate_modules:
      - N_plate_mod : 10
      - ND_plate_mod : 0.5 inch
      - ND_plate_mod_spacer : 0.75 inch
      - sdr_plate_mod_space : 17
    - thickness_plate_mod_ledge : 8 centimeter
    - S_plate_mod_edge : 5 centimeter
    - plate_mod_frame:
      - ND_plate_mod_frame : 1.5 inch
      - S_plate_mod_frame : 0.8
  - floc_weir:
    - angle_weir : 45 degree
    - H_weir_plate_mod_frame : 10 centimeter
    - L_weir_min : 50 centimeter
  - inlet_chan:
    - inlet_weir_freeboard : 2 centimeter
    - thickness_weir : 5 centimeter
    - inlet_hl_max : 1 centimeter
    - ratio_HW : 0.95
  - exit_chan:
  - manifold:
    - ratio_Q_man_orifice : 0.8
    - inlet_man:
      - ND_inlet_man_max : 8 inch
      - sdr_inlet_man : 41
      - dist_inlet_man_bottom_tank_slope : 10 centimeter
      - L_inlet_man_connection_stub : 4 centimeter
      - S_inlet_man_end_diffuser : 3 centimeter
    - exit_man:
      - hl_exit_man : 4 centimeter
      - B_exit_man_orifice : 10 centimeter
      - L_exit_man_cap_excess : 3 centimeter
      - dist_plate_exit_man : 5 centimeter
    - diffuser:
      - edr_diffuser_max : 150 megawatt/kilogram
      - H_jet_reverser_diffuser : 3 centimeter
